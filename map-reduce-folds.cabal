cabal-version:       2.2.0

name:                map-reduce-folds
version:             0.3.0.0
synopsis:            foldl wrappers for map-reduce
description:         wrappers around foldl folds that make it simpler to do map-reduce (or split-apply-combine) style folds.  Includes some general types
                     as well as some simple building blocks and tools for executing the folds in parallel.
-- bug-reports:
license:             BSD-3-Clause
license-file:        LICENSE
author:              Adam Conner-Sax
maintainer:          adam_conner_sax@yahoo.com
-- copyright:
category:            Control
extra-source-files:  CHANGELOG.md    
Build-type: Simple

flag dump-core
  description: Dump HTML for the core generated by GHC during compilation
  default:     False
            
common deps
  build-depends: base                 >= 4.12.0 && < 4.13,
                 containers           >= 0.6.0 && < 0.7,
                 foldl                >= 1.4.5 && < 1.5,
                 profunctors          >= 5.3 && < 5.4,
                 text                 >= 1.2.3 && < 1.3,
                 unordered-containers >= 0.2.10 && < 0.3
               
library
  import: deps
  if flag(dump-core)
    build-depends: dump-core
    ghc-options: -fforce-recomp -fplugin=DumpCore -fplugin-opt DumpCore:core-html  
  ghc-options: -Wall -O2 -fspecialise-aggressively -funbox-strict-fields -fexpose-all-unfoldings
  exposed-modules: Control.MapReduce
                 , Control.MapReduce.Core
                 , Control.MapReduce.Simple
                 , Control.MapReduce.Engines
                 , Control.MapReduce.Engines.GroupBy
                 , Control.MapReduce.Engines.List
                 , Control.MapReduce.Engines.Streaming
                 , Control.MapReduce.Engines.Streamly
                 , Control.MapReduce.Engines.Vector
                 , Control.MapReduce.Engines.Parallel

  build-depends: dlist                >= 0.8.0 && < 0.9,
                 hashable             >= 1.2.7 && < 1.3,
                 vector               >= 0.12.0 && < 0.13,
                 parallel             >= 3.2.2 && < 3.3,
                 split                >= 0.2.3 && < 0.3,
                 streaming            >= 0.2.2 && < 0.3,
                 streamly             >= 0.6.1 && < 0.7

  hs-source-dirs:      src
  default-language:    Haskell2010

  
benchmark bench-map-reduce
  import: deps
  if flag(dump-core)
    build-depends: dump-core
    ghc-options: -fforce-recomp -fplugin=DumpCore -fplugin-opt DumpCore:core-html                    
  type:                exitcode-stdio-1.0
  hs-source-dirs:      bench
  other-modules:       
  ghc-options:         -O3 -fspecialise-aggressively -funbox-strict-fields -fexpose-all-unfoldings -threaded "-with-rtsopts=-N" -funbox-strict-fields -fno-warn-unused-binds -fno-warn-unused-matches -fforce-recomp
  main-is:             MapReduce.hs
  build-depends:       map-reduce-folds >= 0.3.0.0, 
                       criterion ,
                       deepseq ,
                       random
  default-language:    Haskell2010

